% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/survival_advanced.R
\name{survival_analysis}
\alias{survival_analysis}
\title{Competing risks survival analysis between exposure and response diagnoses}
\usage{
survival_analysis(
  exposure_diagnoses,
  response_diagnoses,
  dpop,
  start = c("DATE_EXPOSURE", "DATE_RESPONSE", "DATE_50"),
  censoring_date = as.Date("2024-12-21"),
  pre_entry_handling = c("truncate", "skip", "asis")
)
}
\arguments{
\item{exposure_diagnoses}{A data frame containing exposure diagnoses.
Must include columns \code{ID} and \code{DATE}.}

\item{response_diagnoses}{A data frame containing response diagnoses.
Must include columns \code{ID} and \code{DATE}.}

\item{dpop}{Population-level data frame with at least the columns
\code{ID}, \code{DATE_BIRTH}, \code{DATE_DEATH}, and \code{DATE_MIGRATION}.}

\item{start}{Character string defining the start of follow-up.
One of \code{"DATE_EXPOSURE"}, \code{"DATE_RESPONSE"}, or \code{"DATE_50"}.}

\item{censoring_date}{Date defining administrative censoring
(default: \code{2024-12-21}).}

\item{pre_entry_handling}{Strategy for handling diagnoses occurring before
cohort entry (age 50):
\describe{
  \item{truncate}{Diagnosis date is set to entry date.}
  \item{skip}{Diagnoses before entry are ignored; first post-entry diagnosis is used.}
  \item{asis}{Diagnosis date is used as recorded.}
}}
}
\value{
A named list with the following elements:
\describe{
  \item{plot_days}{\code{ggplot} object of cumulative incidence (days).}
  \item{plot_years}{\code{ggplot} object of cumulative incidence (years).}
  \item{CR_days}{\code{cuminc} object with time in days.}
  \item{CR_years}{\code{cuminc} object with time in years.}
  \item{dsurv}{Final individual-level survival data used in the analysis.}
}
}
\description{
Performs a competing risks survival analysis using registry-based diagnosis
dates. The function supports different follow-up starting points
(exposure, response, or age 50) and multiple strategies for handling
diagnoses that occur before cohort entry. Results include cumulative
incidence estimates and ready-made ggplot visualizations.
}
\details{
The analysis workflow consists of:
\enumerate{
  \item Constructing individual-level date data (birth, death, migration, diagnoses).
  \item Defining follow-up start based on \code{start}.
  \item Handling diagnoses occurring before cohort entry using
  \code{pre_entry_handling}.
  \item Computing event times (exposure, response, death, censoring).
  \item Selecting the first occurring event per individual.
  \item Estimating cumulative incidence functions using
  \code{\link[cmprsk]{cuminc}}.
}

Time is internally calculated in days and additionally expressed in years
(365.25 days). Individuals who die before follow-up start are excluded.
}
\seealso{
\code{\link[cmprsk]{cuminc}},
\code{\link[survminer]{ggcompetingrisks}}
}
